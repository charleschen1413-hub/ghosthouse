<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é™°æ£®å¤§å®… - æš´åŠ›æ»¿ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');

        /* 0. åŸºç¤è¨­å®šï¼šç¦æ­¢æ»¾å‹•ï¼ŒèƒŒæ™¯å…¨é»‘ */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000;
            font-family: 'Creepster', cursive;
            overflow: hidden; touch-action: none;
        }

        /* 1. UI å±¤ï¼šçµ•å°ä½”æ“šé ‚éƒ¨ 12% çš„é«˜åº¦ */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%;
            height: 12%; /* UI ä½” 12% */
            background: linear-gradient(to bottom, #220000, #000);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-bottom: 2px solid #444;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            width: 100%;
            font-size: 1.8rem; /* å¤§å­—é«” */
            line-height: 1;
        }
        #hp-display { color: #ff3e3e; text-shadow: 0 0 10px red; }
        .timer-box { color: #f1c40f; }

        /* 2. æˆ¿å­å®¹å™¨ï¼šçµ•å°å®šä½ï¼Œä½”æ“šå‰©é¤˜ç©ºé–“ */
        .house-container {
            position: absolute;
            top: 12%; /* ç·Šæ¥åœ¨ UI ä¸‹æ–¹ */
            bottom: 10px; /* ç•™ä¸€é»é»åº•é‚Š */
            left: 2%; 
            width: 96%; /* å¹¾ä¹ä½”æ»¿å¯¬åº¦ */
            /* ç§»é™¤ aspect-ratioï¼Œå¼·åˆ¶æ‹‰ä¼¸ */
            background: linear-gradient(180deg, #444 0%, #222 100%);
            border: 4px solid #111;
            /* å±‹é ‚å½¢ç‹€ */
            clip-path: polygon(50% 0%, 100% 10%, 100% 100%, 0% 100%, 0% 10%);
            
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ—æ¨“å±¤ */
            
            padding-top: 10%; /* é ç•™å±‹é ‚å°–ç«¯çš„ç©ºé–“ */
            padding-bottom: 2%;
            padding-left: 2%;
            padding-right: 2%;
            z-index: 10;
        }

        /* 3. æ¨“å±¤ï¼šå¼·åˆ¶å‡åˆ†é«˜åº¦ */
        .floor {
            flex: 1; /* æ¯å€‹æ¨“å±¤è‡ªå‹•å¹³åˆ†å‰©é¤˜é«˜åº¦ */
            width: 100%;
            display: flex;
            justify-content: space-around; /* çª—æˆ¶æ°´å¹³åˆ†ä½ˆ */
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.3);
        }

        /* 4. çª—æˆ¶ï¼šåœ¨æ¨“å±¤ä¸­æ’å¤§ */
        .window {
            width: 17%; /* å¯¬åº¦ä½”æ¨“å±¤çš„ 17% */
            height: 75%; /* é«˜åº¦ä½”æ¨“å±¤çš„ 75% */
            background: #000;
            border: 2px solid #555;
            border-radius: 6px;
            box-shadow: inset 0 0 5px #000;
            position: relative;
        }

        /* é–‹çª—ç‰¹æ•ˆ */
        .window.open {
            background: radial-gradient(circle, #fff3b0 0%, #f1c40f 100%);
            box-shadow: 0 0 25px #f1c40f;
            border-color: #fff;
        }

        /* å¤±æ•—ç‰¹æ•ˆ */
        .window.danger {
            background: #ff0000 !important;
            animation: shake 0.2s infinite;
        }
        @keyframes shake { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* é¬¼é­‚èˆ‡ UI */
        .ghost {
            position: absolute; font-size: 35px; z-index: 200; pointer-events: none;
        }
        #modal {
            position: absolute; inset: 0; background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 500;
        }
        button {
            padding: 20px 60px; font-family: 'Creepster'; font-size: 2.5rem;
            background: #c0392b; color: white; border: none; border-radius: 10px;
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="stats-row">
        <div class="timer-box">TIME: <span id="timer">120</span></div>
        <div id="hp-display"â¤ï¸â¤ï¸â¤ï¸</div>
    </div>
    <div style="font-size: 1rem; color: #888; margin-top: 5px;">NEXT WAVE: <span id="wave-timer">10</span></div>
</div>

<div class="house-container" id="mansion">
    </div>

<div id="modal">
    <h1 id="m-title" style="font-size: 4rem; color: #e74c3c;">SPOOKY HOUSE</h1>
    <button onclick="startGame()">START GAME</button>
</div>

<script>
    const mansion = document.getElementById('mansion');
    const timerEl = document.getElementById('timer');
    const waveEl = document.getElementById('wave-timer');
    const hpEl = document.getElementById('hp-display');
    const modal = document.getElementById('modal');

    let hp = 3;
    let timeLeft = 120;
    let waveCountdown = 10;
    let waveCount = 0;
    let gameActive = false;
    let windows = [];
    let activeIndices = new Set();

    function initMansion() {
        mansion.innerHTML = '';
        windows = [];
        for (let f = 0; f < 5; f++) {
            const floor = document.createElement('div');
            floor.className = 'floor';
            for (let w = 0; w < 5; w++) {
                const win = document.createElement('div');
                win.className = 'window';
                const id = f * 5 + w;
                
                const closeAction = (e) => {
                    e.preventDefault();
                    if (gameActive && activeIndices.has(id)) {
                        activeIndices.delete(id);
                        win.classList.remove('open', 'danger');
                    }
                };
                win.addEventListener('touchstart', closeAction);
                win.addEventListener('mousedown', closeAction);

                floor.appendChild(win);
                windows.push(win);
            }
            mansion.appendChild(floor);
        }
    }

    function startGame() {
        modal.style.display = 'none';
        hp = 3; timeLeft = 120; waveCountdown = 10; waveCount = 0;
        gameActive = true;
        updateHP();
        initMansion();
        triggerWave();
        spawnGhosts();

        const loop = setInterval(() => {
            timeLeft--; waveCountdown--;
            timerEl.innerText = timeLeft;
            waveEl.innerText = waveCountdown;

            if (waveCountdown === 4) checkInvasion();
            if (waveCountdown <= 0) {
                waveCountdown = 10;
                triggerWave();
            }

            if (timeLeft <= 0 || hp <= 0) {
                clearInterval(loop);
                gameActive = false;
                modal.style.display = 'flex';
                document.getElementById('m-title').innerText = hp <= 0 ? "DEVOURED" : "SURVIVED";
            }
        }, 1000);
    }

    function triggerWave() {
        waveCount++;
        activeIndices.clear();
        windows.forEach(w => w.classList.remove('open', 'danger'));
        let count = Math.min(2 * waveCount, 22);
        let ids = [...Array(25).keys()].sort(() => Math.random() - 0.5);
        for (let i = 0; i < count; i++) {
            activeIndices.add(ids[i]);
            windows[ids[i]].classList.add('open');
        }
    }

    function checkInvasion() {
        if (activeIndices.size > 0) {
            hp--;
            updateHP();
            activeIndices.forEach(idx => {
                windows[idx].classList.add('danger');
                showSkull(windows[idx]);
            });
        }
    }

    function showSkull(winElement) {
        const s = document.createElement('div');
        s.className = 'ghost';
        s.innerText = 'ğŸ’€';
        const rect = winElement.getBoundingClientRect();
        s.style.left = rect.left + 'px'; 
        s.style.top = rect.top + 'px';
        document.body.appendChild(s);
        s.animate([{transform:'scale(1)'}, {transform:'scale(5)', opacity:0}], 800);
        setTimeout(() => s.remove(), 800);
    }

    function spawnGhosts() {
        // ç°¡å–®çš„èƒŒæ™¯é¬¼é­‚é‚è¼¯
        setInterval(() => {
            if(!gameActive) return;
            const g = document.createElement('div');
            g.className = 'ghost';
            g.innerText = 'ğŸ‘»';
            g.style.left = Math.random() * 90 + '%';
            g.style.bottom = '0px';
            document.body.appendChild(g);
            g.animate([
                { transform: 'translateY(0)', opacity: 0 },
                { opacity: 0.3, offset: 0.2 },
                { transform: 'translateY(-100vh)', opacity: 0 }
            ], { duration: 5000 });
            setTimeout(() => g.remove(), 5000);
        }, 2000);
    }

    function updateHP() {
        hpEl.innerText = "â¤ï¸".repeat(Math.max(0, hp)) + "ğŸ–¤".repeat(Math.max(0, 3 - hp));
    }

    initMansion();
</script>
</body>
</html>